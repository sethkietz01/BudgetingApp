@model List<BudgetingApp.Models.AssetModel>
@{
    ViewData["Title"] = "Yearly Report";
}

<div class="text-center">
    <h1 class="display-4">Yearly Report</h1>
</div>

<div class="assets-table-div">
    <table id="assets-table" class="table-centered">
        <thead>
            @foreach (var asset in Model)
            {
                <tr>
                    <th>Balance</th>
                    <td>$@asset.Balance</td>
                </tr>
                <tr>
                    <th>Income</th>
                    <td>$@asset.Income</td>
                </tr>
                <tr>
                    <th>Savings</th>
                    <td>$@asset.Savings</td>
                </tr>
                <tr>
                    <th>Rent</th>
                    <td>$@asset.Rent</td>
                </tr>
                <tr>
                    <th>Utilities</th>
                    <td>$@asset.Utilities</td>
                </tr>
                <tr>
                    <th>Car Payment</th>
                    <td>$@asset.CarPayment</td>
                </tr>
                <tr>
                    <th>Insurances</th>
                    <td>$@asset.Insurances</td>
                </tr>
                <tr>
                    <th>Groceries</th>
                    <td>$@asset.Groceries</td>
                </tr>
                <tr>
                    <th>Gas</th>
                    <td>$@asset.Gas</td>
                </tr>
                <tr>
                    <th>Subscriptions</th>
                    <td>$@asset.Subscriptions</td>
                </tr>
                <tr>
                    <th>Other</th>
                    <td>$@asset.Other</td>
                </tr>
                <tr>
                    <th>Total Expenses</th>
                    <td id="total-expenses">$</td>
                </tr>
                <tr>
                    <th>Net</th>
                    <td id="net">$</td>
                </tr>
            }
        </thead>
    </table>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    // Calcualte and populate the total expenses and net for the budgeted expenses table
    $(document).ready(function () {
        // Iterate through each table in the asset tables div
        $('.assets-table-div table').each(function() {
            let totalExpenses = 0;
            let totalIncome = 0;

            // Get all table records in the current table
            const $table = $(this);
            const $rows = $table.find('tr');

            // Iterate through each row in the current table
            $rows.each(function() {
                const $row = $(this);
                const header = $row.find('th').text().trim();
                const $valueCell = $row.find('td');

                // If a table data cell exists in the current row
                if ($valueCell.length) {
                    const valueText = $valueCell.text().trim();
                    const numericValue = parseFloat(valueText.replace(/[^\d.]/g, '')); // Extract number

                    // Determine which expense it is and add or subtract from totalIncome accordingly
                    if (header === 'Balance')
                        balance = numericValue;
                    else if (header === 'Income')
                        totalIncome += numericValue;
                    else if (['Rent', 'Savings', 'Utilites', 'Car Payment', 'Insurances', 'Groceries', 'Gas', 'Subscriptions', 'Other'].includes(header))
                        totalExpenses += numericValue;
                    else if (header === 'Total Expenses')
                        $row.find('#total-expenses').text('$' + totalExpenses.toFixed(2));
                    else if (header === 'Net') {
                        const $netCell = $row.find('#net');
                        const netAmount = totalIncome - totalExpenses;
                        $netCell.text('$' + netAmount.toFixed(2));

                        if (netAmount < 0)
                            $netCell.css('color', 'red');
                        else
                            $netCell.css('color', 'green');
                    }
                }
            });
        });
    });
</script>